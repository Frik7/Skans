name: CI

# 1. The Triggers
# We trigger on ANY Pull Request targeting main.
# We also trigger on pushes to main (to catch merge issues).
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

# 2. The Jobs
jobs:
  quality-check:
    name: Quality & Tests
    runs-on: ubuntu-latest
    
    steps:
      # Step A: Get the code
      - name: Checkout code
        uses: actions/checkout@v4

      # Step B: Set up Python environment
      - name: Set up Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"
          cache: "pip" # Caches dependencies to speed up future runs

      # Step C: Install your project + dev tools
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # Installs 'skans' in editable mode along with 'dev' dependencies
          # defined in pyproject.toml
          pip install -e .[dev]

      # Step D: The Enforcers (Fail fast if these break)
      
      - name: Check Formatting (Black)
        # --check means "don't fix it, just tell me if it's wrong"
        run: black --check src tests

      - name: Lint Code (Flake8)
        run: flake8 src tests

      - name: Type Check (Mypy)
        run: mypy src tests

      # Step E: The Validator
      - name: Run Tests (Pytest)
        run: pytest